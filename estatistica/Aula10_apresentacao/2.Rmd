---
title: "Vinho Bom √© Vinho Caro?"
subtitle: "An√°lise da Rela√ß√£o entre Pre√ßo e Qualidade em Vinhos"
author: "Vin√≠cius Cebalhos"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: united
    code_folding: hide
    number_sections: true
---

```{r setup, include=FALSE}
# Configura√ß√µes iniciais do R Markdown
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 6)

# Carregar bibliotecas necess√°rias
library(tidyverse)
library(knitr)
library(scales)
library(gridExtra)
```

# Introdu√ß√£o

## O Conjunto de Dados

Este estudo utiliza o **Wine Reviews Dataset**, uma base de dados com **quase 130.000 avalia√ß√µes de vinhos** provenientes da revista Wine Enthusiast. 

**Caracter√≠sticas principais dos dados:**

- **Origem:** Avalia√ß√µes profissionais de sommeliers

- **Per√≠odo:** Vinhos avaliados at√© 2017

- **Escopo geogr√°fico:** Vinhos de diversos pa√≠ses

- **Vari√°veis principais:** pre√ßo (USD), pontua√ß√£o (80-100), pa√≠s, variedade da uva, descri√ß√£o

**Por que estes dados s√£o relevantes:**

- Representam avalia√ß√µes padronizadas e profissionais

- Cobrem ampla faixa de pre√ßos (de $4 a mais de $3.000)

- Incluem vinhos de diferentes tradi√ß√µes vitivin√≠colas mundiais

```{r data-loading}
# Carregar e preparar os dados
wine_data <- read_csv("winemag-data-130k-v2.csv")

# Limpeza: manter apenas vinhos com pre√ßo e pontua√ß√£o v√°lidos
wine_data_clean <- wine_data %>%
  filter(!is.na(price), !is.na(points))

# Estat√≠sticas descritivas
cat("üìä RESUMO DOS DADOS:\n")
cat("‚Ä¢ Total original:", nrow(wine_data), "vinhos\n")
cat("‚Ä¢ Ap√≥s limpeza:", nrow(wine_data_clean), "vinhos\n")
cat("‚Ä¢ Faixa de pre√ßos: $", min(wine_data_clean$price), " - $", max(wine_data_clean$price), "\n")
cat("‚Ä¢ Faixa de pontua√ß√£o:", min(wine_data_clean$points), "-", max(wine_data_clean$points), "pontos\n")
cat("‚Ä¢ Pa√≠ses representados:", length(unique(wine_data_clean$country)), "\n")
cat("‚Ä¢ Variedades de uva:", length(unique(wine_data_clean$variety)), "\n")
```

# Objetivo

## Pergunta de Pesquisa Principal

> **"VINHO BOM √â VINHO CARO?"**

**Objetivos espec√≠ficos:**

1. **Investigar se existe correla√ß√£o significativa** entre pre√ßo e qualidade dos vinhos

2. **Comparar as m√©dias de qualidade** entre diferentes categorias de pre√ßo

3. **Analisar caracter√≠sticas comuns** dos vinhos de m√°xima qualidade

**Hip√≥teses a serem testadas:**

- **H1:** Existe correla√ß√£o positiva significativa entre pre√ßo e pontua√ß√£o

- **H2:** Vinhos mais caros t√™m m√©dias de pontua√ß√£o significativamente maiores

# Desenvolvimento

## An√°lise Explorat√≥ria Inicial

```{r exploratory}
# Visualiza√ß√£o da rela√ß√£o pre√ßo-qualidade
ggplot(wine_data_clean, aes(x = price, y = points)) +
  geom_point(alpha = 0.3, color = "darkred") +
  geom_smooth(method = "lm", color = "gold", se = TRUE, size = 1.2) +
  scale_x_log10(labels = dollar_format()) +
  labs(title = "üç∑ RELA√á√ÉO PRE√áO vs QUALIDADE",
       subtitle = "Cada ponto representa um vinho avaliado",
       x = "Pre√ßo (USD, escala logar√≠tmica)",
       y = "Pontua√ß√£o (80-100 pontos)") +
  theme_minimal() +
  theme(plot.title = element_text(size = 18, face = "bold"),
        plot.subtitle = element_text(size = 12))
```

## Teste de Hip√≥tese 1: Correla√ß√£o de Pearson

**OBJETIVO:** Verificar se existe rela√ß√£o linear entre pre√ßo e qualidade

```{r correlation-test}
# Teste de Correla√ß√£o de Pearson
cor_test <- cor.test(wine_data_clean$price, wine_data_clean$points)
cor_coef <- round(cor_test$estimate, 3)
p_value <- round(cor_test$p.value, 10)

cat("üîç TESTE DE CORRELA√á√ÉO DE PEARSON\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
cat("Coeficiente de Correla√ß√£o (r):", cor_coef, "\n")
cat("Valor p:", format(p_value, scientific = TRUE), "\n")

# Interpreta√ß√£o
interpretacao <- case_when(
  abs(cor_coef) >= 0.7 ~ "forte",
  abs(cor_coef) >= 0.5 ~ "moderada",
  abs(cor_coef) >= 0.3 ~ "fraca",
  TRUE ~ "muito fraca"
)

cat("\n‚úÖ RESULTADO:\n")
cat("‚Ä¢ Correla√ß√£o:", interpretacao, "positiva\n")
cat("‚Ä¢ Signific√¢ncia:", ifelse(p_value < 0.05, "SIGNIFICATIVA (p < 0.05)", "N√ÉO significativa"), "\n")
cat("‚Ä¢ Conclus√£o: A hip√≥tese H1 √©", ifelse(p_value < 0.05 & cor_coef > 0, "ACEITA", "REJEITADA"), "\n")
```

## Teste de Hip√≥tese 2: ANOVA (Compara√ß√£o de M√©dias)

**OBJETIVO:** Comparar m√©dias de qualidade entre categorias de pre√ßo

```{r price-categories}
# Definir categorias de pre√ßo baseadas nos quartis
quartis <- quantile(wine_data_clean$price, probs = c(0.33, 0.67))

wine_data_groups <- wine_data_clean %>%
  mutate(categoria_preco = case_when(
    price <= quartis[1] ~ "üí∞ Econ√¥mico",
    price <= quartis[2] ~ "üí∞üí∞ M√©dio", 
    price > quartis[2] ~ "üí∞üí∞üí∞ Caro"
  )) %>%
  mutate(categoria_preco = factor(categoria_preco, 
                                 levels = c("üí∞ Econ√¥mico", "üí∞üí∞ M√©dio", "üí∞üí∞üí∞ Caro")))

# Mostrar as faixas de pre√ßo
cat("üìä CATEGORIAS DE PRE√áO DEFINIDAS:\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
cat("üí∞ Econ√¥mico: at√© $", round(quartis[1], 0), "\n")
cat("üí∞üí∞ M√©dio: $", round(quartis[1], 0), " - $", round(quartis[2], 0), "\n")
cat("üí∞üí∞üí∞ Caro: acima de $", round(quartis[2], 0), "\n\n")

# Distribui√ß√£o
wine_data_groups %>%
  count(categoria_preco) %>%
  mutate(percentual = round(n/sum(n)*100, 1)) %>%
  kable(caption = "Distribui√ß√£o dos Vinhos por Categoria de Pre√ßo")
```

```{r boxplot}
# Boxplot comparativo
ggplot(wine_data_groups, aes(x = categoria_preco, y = points, fill = categoria_preco)) +
  geom_boxplot(alpha = 0.7, outlier.alpha = 0.3) +
  #geom_jitter(width = 0.2, alpha = 0.1, size = 0.3) +
  scale_fill_manual(values = c("#3498db", "#f39c12", "#e74c3c")) +
  labs(title = "üìä DISTRIBUI√á√ÉO DA QUALIDADE POR CATEGORIA DE PRE√áO",
       subtitle = "Ser√° que vinhos caros s√£o consistentemente melhores?",
       x = "Categoria de Pre√ßo",
       y = "Pontua√ß√£o (80-100)") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(size = 16, face = "bold"),
        axis.text.x = element_text(size = 12))
```

```{r anova-test}
# Teste ANOVA
anova_test <- aov(points ~ categoria_preco, data = wine_data_groups)
anova_summary <- summary(anova_test)

cat("üîç TESTE ANOVA (AN√ÅLISE DE VARI√ÇNCIA)\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
print(anova_summary)

# Estat√≠sticas descritivas por grupo
medias_por_grupo <- wine_data_groups %>%
  group_by(categoria_preco) %>%
  summarise(
    media_pontos = round(mean(points), 2),
    mediana = round(median(points), 2),
    desvio_padrao = round(sd(points), 2),
    n = n(),
    .groups = 'drop'
  )

cat("\nüìà M√âDIAS POR CATEGORIA:\n")
kable(medias_por_grupo, caption = "Estat√≠sticas por Categoria de Pre√ßo")

# Interpretar resultado
f_value <- round(anova_summary[[1]][["F value"]][1], 2)
p_value_anova <- anova_summary[[1]][["Pr(>F)"]][1]

cat("\n‚úÖ RESULTADO ANOVA:\n")
cat("‚Ä¢ Valor F:", f_value, "\n")
cat("‚Ä¢ Valor p:", format(p_value_anova, scientific = TRUE), "\n")
cat("‚Ä¢ Conclus√£o: A hip√≥tese H2 √©", ifelse(p_value_anova < 0.05, "ACEITA", "REJEITADA"), "\n")

# Diferen√ßas pr√°ticas
diff1 <- medias_por_grupo$media_pontos[2] - medias_por_grupo$media_pontos[1]
diff2 <- medias_por_grupo$media_pontos[3] - medias_por_grupo$media_pontos[2]

cat("\nüìä DIFEREN√áAS PR√ÅTICAS:\n")
cat("‚Ä¢ M√©dio vs Econ√¥mico: +", round(diff1, 1), "pontos\n")
cat("‚Ä¢ Caro vs M√©dio: +", round(diff2, 1), "pontos\n")
```

## An√°lise B√¥nus: Caracter√≠sticas dos Vinhos Excepcionais

**OBJETIVO:** Identificar padr√µes comuns nos vinhos de m√°xima qualidade (‚â•95 pontos)

```{r elite-analysis}
# Filtrar vinhos excepcionais
vinhos_excepcionais <- wine_data_clean %>%
  filter(points >= 95)

total_excepcionais <- nrow(vinhos_excepcionais)
percentual <- round(total_excepcionais/nrow(wine_data_clean)*100, 2)

cat("üèÜ VINHOS EXCEPCIONAIS (‚â•95 pontos)\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
cat("‚Ä¢ Quantidade:", total_excepcionais, "vinhos\n")
cat("‚Ä¢ Percentual:", percentual, "% do total\n")
cat("‚Ä¢ Pre√ßo m√©dio: $", round(mean(vinhos_excepcionais$price, na.rm = TRUE), 0), "\n")
cat("‚Ä¢ Pontua√ß√£o m√©dia:", round(mean(vinhos_excepcionais$points), 1), "pontos\n")
```

```{r elite-plots, fig.height=8}
# An√°lise por pa√≠s
top_paises <- vinhos_excepcionais %>%
  count(country, sort = TRUE) %>%
  top_n(8, n) %>%
  ggplot(aes(x = reorder(country, n), y = n, fill = country)) +
  geom_col(alpha = 0.8) +
  coord_flip() +
  scale_fill_viridis_d() +
  labs(title = "üåç Pa√≠ses com Mais Vinhos Excepcionais", 
       x = "Pa√≠s", y = "Quantidade") +
  theme_minimal() +
  theme(legend.position = "none")

# An√°lise por variedade
top_variedades <- vinhos_excepcionais %>%
  count(variety, sort = TRUE) %>%
  top_n(8, n) %>%
  ggplot(aes(x = reorder(variety, n), y = n, fill = variety)) +
  geom_col(alpha = 0.8) +
  coord_flip() +
  scale_fill_viridis_d(option = "plasma") +
  labs(title = "üçá Variedades Mais Comuns na Excel√™ncia", 
       x = "Variedade de Uva", y = "Quantidade") +
  theme_minimal() +
  theme(legend.position = "none")

grid.arrange(top_paises, top_variedades, ncol = 2)

# Tabelas resumo
cat("\nüèÜ TOP 5 PA√çSES NA EXCEL√äNCIA:\n")
vinhos_excepcionais %>%
  count(country, sort = TRUE) %>%
  head(5) %>%
  kable()

cat("\nüçá TOP 5 VARIEDADES NA EXCEL√äNCIA:\n")
vinhos_excepcionais %>%
  count(variety, sort = TRUE) %>%
  head(5) %>%
  kable()
```

# Conclus√£o

```{r final-summary}
cat("üéØ RESUMO DOS ACHADOS PRINCIPAIS:\n")
cat("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n")
cat("1. Correla√ß√£o pre√ßo-qualidade:", cor_coef, "(", interpretacao, ")\n")
cat("2. Signific√¢ncia estat√≠stica:", ifelse(p_value < 0.05, "SIM", "N√ÉO"), "\n")
cat("3. Diferen√ßas entre categorias:", ifelse(p_value_anova < 0.05, "SIGNIFICATIVAS", "N√ÉO significativas"), "\n")
cat("4. Vinhos excepcionais:", percentual, "% do total\n")
```

## Resposta √† Pergunta: "Vinho Bom √© Vinho Caro?"

**A resposta √©: PARCIALMENTE SIM, mas com importantes ressalvas.**

**Evid√™ncias a favor:**

- Existe correla√ß√£o positiva **estatisticamente significativa** entre pre√ßo e qualidade (r = `r cor_coef`, p < 0.001)

- Vinhos caros t√™m m√©dias de pontua√ß√£o **significativamente maiores** que vinhos econ√¥micos

- As diferen√ßas entre categorias s√£o **estatisticamente comprovadas** (ANOVA, p < 0.001)

**Ressalvas importantes:**

- A correla√ß√£o √© **fraca/moderada** (`r cor_coef`), explicando apenas `r round(cor_coef^2*100, 1)`% da varia√ß√£o na qualidade

- As diferen√ßas pr√°ticas s√£o **pequenas**: vinhos caros pontuam apenas `r round(diff1 + diff2, 1)` pontos a mais que econ√¥micos

- Existem **muitos vinhos caros com qualidade mediana** e **vinhos baratos com alta qualidade**

**Sobre a excel√™ncia (‚â•95 pontos):**

- Representa apenas `r percentual`% de todos os vinhos avaliados

- Concentra-se em **pa√≠ses tradicionais** (Fran√ßa, EUA, It√°lia) e **variedades cl√°ssicas** (Pinot Noir, Chardonnay)

- Sugere que **tradi√ß√£o, terroir e expertise** s√£o fatores cruciais al√©m do pre√ßo

**Conclus√£o pr√°tica:** O pre√ßo √© um **indicador √∫til mas imperfeito** da qualidade. Para consumidores, significa que vinhos mais caros tendem a ser melhores, mas existem **excelentes oportunidades** em faixas de pre√ßo mais acess√≠veis. A qualidade excepcional depende de uma combina√ß√£o de fatores que vai al√©m do pre√ßo.

---
*An√°lise baseada em 129.971 avalia√ß√µes profissionais de vinhos*